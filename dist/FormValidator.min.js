/*!
bower-validation v0.0.0 
Component for validation of codeigniter forms
Build time: Tue May 21 2013 12:29:44 GMT+0100 (BST)
*/

(function(window,document,undefined){var defaults={messages:{required:"The %s field is required.",matches:"The %s field does not match the %s field.",valid_email:"The %s field must contain a valid email address.",valid_emails:"The %s field must contain all valid email addresses.",min_length:"The %s field must be at least %s characters in length.",max_length:"The %s field must not exceed %s characters in length.",exact_length:"The %s field must be exactly %s characters in length.",greater_than:"The %s field must contain a number greater than %s.",less_than:"The %s field must contain a number less than %s.",alpha:"The %s field must only contain alphabetical characters.",alpha_numeric:"The %s field must only contain alpha-numeric characters.",alpha_dash:"The %s field must only contain alpha-numeric characters, underscores, and dashes.",numeric:"The %s field must contain only numbers.",integer:"The %s field must contain an integer.",decimal:"The %s field must contain a decimal number.",is_natural:"The %s field must contain only positive numbers.",is_natural_no_zero:"The %s field must contain a number greater than zero.",valid_ip:"The %s field must contain a valid IP.",valid_base64:"The %s field must contain a base64 string.",valid_credit_card:"The %s field must contain a vaild credit card number",is_file_type:"The %s field must contain only %s files.",valid_url:"The %s field must contain a valid URL."},callback:function(){}},ruleRegex=/^(.+?)\[(.+)\]$/,numericRegex=/^[0-9]+$/,integerRegex=/^\-?[0-9]+$/,decimalRegex=/^\-?[0-9]*\.?[0-9]+$/,emailRegex=/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]+)*$/,alphaRegex=/^[a-z]+$/i,alphaNumericRegex=/^[a-z0-9]+$/i,alphaDashRegex=/^[a-z0-9_\-]+$/i,naturalRegex=/^[0-9]+$/i,naturalNoZeroRegex=/^[1-9][0-9]*$/i,ipRegex=/^((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){3}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})$/i,base64Regex=/[^a-zA-Z0-9\/\+=]/i,numericDashRegex=/^[\d\-\s]+$/,urlRegex=/^((http|https):\/\/(\w+:{0,1}\w*@)?(\S+)|)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,FormValidator=function(formName,fields,callback){this.callback=callback||defaults.callback,this.errors=[],this.fields={},this.form=document.forms[formName]||{},this.messages={},this.handlers={};for(var i=0,fieldLength=fields.length;fieldLength>i;i++){var field=fields[i];field.name&&field.rules&&(this.fields[field.name]={name:field.name,display:field.display||field.name,rules:field.rules,id:null,type:null,value:null,checked:null})}var _onsubmit=this.form.onsubmit;this.form.onsubmit=function(that){return function(evt){try{return that._validateForm(evt)&&(_onsubmit===undefined||_onsubmit())}catch(e){}}}(this)},attributeValue=function(element,attributeName){var i;{if(!(element.length>0&&"radio"===element[0].type))return element[attributeName];for(i=0;element.length>i;i++)if(element[i].checked)return element[i][attributeName]}};FormValidator.prototype.setMessage=function(rule,message){return this.messages[rule]=message,this},FormValidator.prototype.registerCallback=function(name,handler){return name&&"string"==typeof name&&handler&&"function"==typeof handler&&(this.handlers[name]=handler),this},FormValidator.prototype._validateForm=function(evt){this.errors=[];for(var key in this.fields)if(this.fields.hasOwnProperty(key)){var field=this.fields[key]||{},element=this.form[field.name];element&&element!==undefined&&(field.id=attributeValue(element,"id"),field.type=element.length>0?element[0].type:element.type,field.value=attributeValue(element,"value"),field.checked=attributeValue(element,"checked"),this._validateField(field))}return"function"==typeof this.callback&&this.callback(this.errors,evt),this.errors.length>0&&(evt&&evt.preventDefault?evt.preventDefault():event&&(event.returnValue=!1)),!0},FormValidator.prototype._validateField=function(field){var rules=field.rules.split("|");if(-1!==field.rules.indexOf("required")||field.value&&""!==field.value&&field.value!==undefined||-1!==field.rules.indexOf("callback_")&&null!==field.value)for(var i=0,ruleLength=rules.length;ruleLength>i;i++){var method=rules[i],param=null,failed=!1,parts=ruleRegex.exec(method);if(parts&&(method=parts[1],param=parts[2]),"function"==typeof this._hooks[method]?this._hooks[method].apply(this,[field,param])||(failed=!0):"callback_"===method.substring(0,9)&&(method=method.substring(9,method.length),"function"==typeof this.handlers[method]&&this.handlers[method].apply(this,[field.value])===!1&&(failed=!0)),failed){var source=this.messages[method]||defaults.messages[method],message="An error has occurred with the "+field.display+" field.";source&&(message=source.replace("%s",field.display),param&&(message=message.replace("%s",this.fields[param]?this.fields[param].display:param))),this.errors.push({id:field.id,name:field.name,message:message,rule:method});break}}},FormValidator.prototype._hooks={required:function(field){var value=field.value;return"checkbox"===field.type||"radio"===field.type?field.checked===!0:null!==value&&""!==value},matches:function(field,matchName){var el=this.form[matchName];return el?field.value===el.value:!1},valid_email:function(field){return emailRegex.test(field.value)},valid_emails:function(field){for(var result=field.value.split(","),i=0;result.length>i;i++)if(!emailRegex.test(result[i]))return!1;return!0},min_length:function(field,length){return numericRegex.test(length)?field.value.length>=parseInt(length,10):!1},max_length:function(field,length){return numericRegex.test(length)?field.value.length<=parseInt(length,10):!1},exact_length:function(field,length){return numericRegex.test(length)?field.value.length===parseInt(length,10):!1},greater_than:function(field,param){return decimalRegex.test(field.value)?parseFloat(field.value)>parseFloat(param):!1},less_than:function(field,param){return decimalRegex.test(field.value)?parseFloat(field.value)<parseFloat(param):!1},alpha:function(field){return alphaRegex.test(field.value)},alpha_numeric:function(field){return alphaNumericRegex.test(field.value)},alpha_dash:function(field){return alphaDashRegex.test(field.value)},numeric:function(field){return decimalRegex.test(field.value)},integer:function(field){return integerRegex.test(field.value)},decimal:function(field){return decimalRegex.test(field.value)},is_natural:function(field){return naturalRegex.test(field.value)},is_natural_no_zero:function(field){return naturalNoZeroRegex.test(field.value)},valid_ip:function(field){return ipRegex.test(field.value)},valid_base64:function(field){return base64Regex.test(field.value)},valid_url:function(field){return urlRegex.test(field.value)},valid_credit_card:function(field){if(!numericDashRegex.test(field.value))return!1;for(var nCheck=0,nDigit=0,bEven=!1,strippedField=field.value.replace(/\D/g,""),n=strippedField.length-1;n>=0;n--){var cDigit=strippedField.charAt(n);nDigit=parseInt(cDigit,10),bEven&&(nDigit*=2)>9&&(nDigit-=9),nCheck+=nDigit,bEven=!bEven}return 0===nCheck%10},is_file_type:function(field,type){if("file"!==field.type)return!0;var ext=field.value.substr(field.value.lastIndexOf(".")+1),typeArray=type.split(","),inArray=!1,i=0,len=typeArray.length;for(i;len>i;i++)ext==typeArray[i]&&(inArray=!0);return inArray}},window.FormValidator=FormValidator})(window,document),define("validate",function(global){return function(){var ret;return ret||global.FormValidator}}(this)),function(){define("FormValidator",["validate","mootools"],function(FormValidator){var FormValidation;return FormValidation=function(){function FormValidation(form,options){var field,formName,i,messages,rule,string,validateFields,validator,_i,_len;for(this.form=form,this.options=null!=options?options:{},messages=JSON.parse(this.form.getProperty("data-validate-messages")),validateFields=JSON.parse(this.form.getProperty("data-validate-fields")),i=_i=0,_len=validateFields.length;_len>_i;i=++_i)field=validateFields[i],validateFields[i].name=field.field;formName=this.form.getProperty("name"),null==formName&&(formName="FormValidator"+(new Date).getTime(),this.form.setProperty("name","FormValidator"+(new Date).getTime())),validator=new FormValidator(formName,validateFields,this.options.onError);for(rule in messages)string=messages[rule],validator.setMessage(rule,string)}return FormValidation}()})}.call(this);